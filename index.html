<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Hibernate & Elasticsearch</title>

		<meta name="description" content="A presentation about Apache Lucene, Hibernate Search, Infinispan Query, the Infinispan Directory and OSS related ecosystem">
		<meta name="author" content="Sanne Grinovero">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/custom.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Hibernate & Elasticsearch</h1>
					<h3>19 January 2016</h3>
					<p>
						<small>by <a href="http://twitter.com/sannegrinovero">@SanneGrinovero</a> & <a href="http://twitter.com/emmanuelbernard">@emmanuelbernard</a></small>
					</p>
					<aside class="notes">
<p>There's a <a href="https://github.com/hakimel/reveal.js#speaker-notes">speaker view</a>. It includes a timer, preview of the upcoming slide as well as your speaker notes.</p>
<p>Press the <em>S</em> key to try it out.</p>
<p>Oh hey, these are some notes. They'll be hidden in your presentation, but you can see them if you open the speaker notes window (hit 's' on your keyboard).</p>
<p>Press B or . on your keyboard to pause the presentation. This is helpful when you're on stage and want to take distracting slides off the screen.</p>
					</aside>
				</section>

				<section>
					<h3>Who is Sanne Grinovero?</h3>
<section>
						<h3>Hibernate Team</h3>
						<p><em>Hibernate Search</em> project lead</p>
						<p>Hibernate ORM - performance improvements</p>
						<p>Hibernate OGM - NoSQL R&D</p>
</section>
<section>
						<h4>contributing to Infinispan</h4>
						<p>the Lucene integrations: <em>Infinispan Query</em>, <em>Infinispan Lucene Directory</em>, cluster extensions for <em>Hibernate Search</em></p>
</section>
<section>
						<h4>Some other projects I occasionally help with:</h4>
						<p>WildFly, JGroups, <em>Apache Lucene</em>, OpenJDK, Bean Validation,...</p>
</section>
				</section>

				<section>
					<h3>Who is Emmanuel Bernard?</h3>
						<h4>Architect of the Data Platforms at Red Hat</h4>	
						<p><em>Hibernate Search</em> project founder</p>
						<p>Leading all of Hibernate R&D</p>
</section>

<section>
	<h2>Agenda</h2>
	<ul>
		<li>What's Hibernate Search again?</li>
		<li>Quick demo</li>
		<li>Overview of integrations and roadmap</li>
		<li>Wishes for the future</li>
	</ul>
</section>

<section>
	<h2>Hibernate Search Quickstart</h2>
<pre><code><!-- Add the main Hibernate Search depedency -->
<dependency>
   <groupId>org.hibernate</groupId>
   <artifactId>hibernate-search-orm</artifactId>
   <version>5.6.0.CR1</version>
</dependency>

<!-- Also enable the new Elasticsearch integration -->
<dependency>
   <groupId>org.hibernate</groupId>
   <artifactId>hibernate-search-elasticsearch</artifactId>
   <version>5.6.0.CR1</version>
</dependency>
</pre></code>
</section>

<section>
            <h2>Set basic configuration properties</h2>
        <pre><code>
hibernate.search.default.indexmanager elasticsearch
hibernate.search.default.elasticsearch.host http://127.0.0.1:9200
hibernate.search.default.elasticsearch.index_schema_management_strategy CREATE
</code>
</pre>
</section>


<section>
	<h2>Choose what and how to index</h2>
	<section data-transition="fade">
<pre><code>
@Entity
public class Actor {
	
	@Id
	Integer id;
	
	String name;

}
</code>
</pre>
	</section>
	<section data-transition="fade">
<pre><code>
@Indexed @Entity
public class Actor {
	
	@Id
	Integer id;
	
	String name;

}
</code>
</pre>
	</section>
	<section data-transition="fade">
<pre><code>
@Indexed @Entity
public class Actor {
	
	@Id
	Integer id;
	
	@Field
	String name;

}
</code>
</pre>
	</section>
</section>

<section>
	<h2>Relations</h2>
	<section data-transition="fade">
<pre><code>
@Entity
public class Movie {

	@Id
	Integer id;


	String title;

	@ManyToMany
	Set&lt;Actor&gt; actors = new HashSet&lt;&gt;();

}</code>
</pre>
	</section>
	<section data-transition="fade">
<pre><code>
@Indexed @Entity
public class Movie {

	@Id
	Integer id;


	String title;

	@ManyToMany
	Set&lt;Actor&gt; actors = new HashSet&lt;&gt;();

}</code>
</pre>
	</section>
<section data-transition="fade">
<pre><code>
@Indexed @Entity
public class Movie {

	@Id
	Integer id;

	@Field
	String title;

	@ManyToMany
	Set&lt;Actor&gt; actors = new HashSet&lt;&gt;();

}</code>
</pre>
</section>
<section data-transition="fade">
<pre><code>
@Indexed @Entity
public class Movie {

	@Id
	Integer id;

	@Field
	String title;

	@ManyToMany @IndexedEmbedded
	Set&lt;Actor&gt; actors = new HashSet&lt;&gt;();

}</code>
</pre>
</section>

</section>

<section>
	<h2>Profit...</h2>
<pre><code>
String[] productFields = { "title", "actors.name" };

org.apache.lucene.search.Query luceneQuery = // ...

FullTextEntityManager ftEm =
   Search.getFullTextEntityManager( entityManager );

FullTextQuery query = // extends javax.persistence.Query
   ftEm.createFullTextQuery( luceneQuery, Movie.class );

List movies = query.setMaxResults(10).getResultList();// Managed entities!

int totalNbrOfResults = query.getResultSize();
</pre></code>
</section>

<section data-transition="slide" data-background="#1055bc" data-background-transition="zoom">
	<h2>Demo!</h2>
</section>

<section>
	<h2>Filters</h2>
<section>
<pre><code>
List results = fullTextEntityManager
   .createFullTextQuery( query, Product.class )
   .enableFullTextFilter( "minorsFilter" )
   .list();
</pre></code>
</section>
<section>
<pre><code>
List results = fullTextEntityManager
   .createFullTextQuery( query, Product.class )
   .enableFullTextFilter( "minorsFilter" )
   .enableFullTextFilter( "specialDayOffers" )
      .setParameter( "day", “20151029” )
   .enableFullTextFilter( "inStockAt" )
      .setParameter( "location", "San Francisco" )
   .list();
</pre></code>
</section>
</section>

<section>
	<h2>Faceting</h2>
	<img data-src="./images/AmazonFaceting.png"></p>
</section>

<section>
	<h2>Spatial filtering</h2>
	<img data-src="./images/SpatialFilteringConcept.png"></p>
</section>

<section>
<h2>Beyond "Hibernate ORM" integrations!</h2>
<section>
<br></br>
		<img data-src="./images/HibernateSearchEngineWhereItFits.svg">
	</section>
	</section>
<section>
            <h2>Hibernate OGM</h2>
            <p>All the same as Hibernate ORM, but for NoSQL</p>
            <ul>
<li>MongoDB</li>
<li>Cassandra</li>
<li>Neo4J</li>
<li>CouchDB</li>
<li>Ehcache</li>
<li>Infinispan</li>
<li>Redis</li>
</ul>
<p>Might use better search too!</p>
</section>            


<section>
	<h2>Hibernate Search & Infinispan Query</h2>
	<section>
	<ul>
		<li>Same underlying technology</li>
		<li>Same API to learn</li>
		<li>Same indexing configuration options</li>
	</ul>
	</section>

        <section>
<br/><br/>	
            <p>Booting Infinispan<p>
        <pre><code class="xml">
&lt;dependency&gt;
   &lt;groupId&gt;org.infinispan&lt;/groupId&gt;
   &lt;artifactId&gt;infinispan-embedded&lt;/artifactId&gt;
   &lt;version&gt;8.2.5.Final&lt;/version&gt;
&lt;/dependency&gt;
        </code>
        <code class="java">
EmbeddedCacheManager cacheManager = new DefaultCacheManager();
Cache&lt;String,String&gt; cache = cacheManager.getCache();

cache.put("key", "data goes here");
        </code></pre>
        </section>
	<section>
		<br/><br/>
		<p>Same annotations, not an entity:</p>
		<p>
<pre><code class="java">@Indexed
public class Country {

    @Field(store = Store.YES)
    @Analyzer(definition = "lowercaseKeyword")
    private String name;

...
</code></pre></p>
	</section>
	<section>
<p>Store the Java POJO instances in the cache directly:</p>
<pre><code class="java">

Country uk = ...
cache.put("UK", uk );

</code>
</pre>
	</section>

	<section>
<p>Query it!</p>
            <pre><code class="java" style="max-width: 100%">
QueryParser qp = new QueryParser("default", new StandardAnalyzer());
                
Query luceneQ = qp
 .parse("+station.name:airport +year:2014 +month:12 +(avgTemp < 0)");

CacheQuery cq = Search.getSearchManager(cache)
                           .getQuery(luceneQ, DaySummary.class);
                
List&lt;Object&gt; results = query.list();
            </code></pre>
        </section>
</section>

<section data-transition="slide" data-background="#4d7e65" data-background-transition="zoom">
	<h2>What's coming next?</h2>
</section>

<section>
<h2>Hibernate Search planning</h2>
<ul>
<li>Release 5.6.0.Final in a few days</li>
<li>Release 5.7 shortly after to catch up with Hibernate ORM</li>
<li>Elasticsearch 5.0 ?</li>
<li>Elasticsearch clients ?</li>
<li>Properly "detach" from the Lucene API -> 6.0</li>
<li>Prototype Apache Solr integration (6.1?)</li>
</ul>
</section>

<section>
<h2>Wishes on Elasticsearch:</h2>
	<section>
Warning! wishful thinking ahead...
	</section>
	<section>
<br/>
<h3>Dry-run or “all or nothing” for schema updates</h3>
<ul>
<li>Allow a single Batch?</li>
<li>Transactional (handle client crash)?</li>
<li>Semaphore to allow a single client to initiate admin ops?</li>
</ul>
	</section>
	<section>
<h3>Live incremental update of Analyzers</h3>
<p>Be able to add new analyzer definitions w/o having to temporarily close the index
</p>
	</section>
	<section>
<h3>Allow faithful projections for all types</h3>
<ul>
<li>We currently need to store the source document to make sure we can faithfully store e.g. a java.time.ZonedDateTime, as the "stored" field will always return them in UTC.</li>
<li>The benefits of storing the source document are understood, still we don't want to force this requirement.</li>
</ul>
	</section>
	<section>
<h3>Improve backwards compatibility</h3>
<ul>
<li>We can't ask users to update their client applications at the same time as they upgrade Elasticsearch: allow breaking the process down in smaller steps.</li>
<li>We will try to work towards supporting multiple "dialects": detect the version of Elasticsearch and apply variations to the generated requests. (here be dragons?)</li>
<li>Same for JVM versions: the client needs to be more conservative.
</ul>
	</section>
	<section>
<br/>
<h4>New Elasticsearch client: release and packaging process</h4>
<ul>
<li>Same repository? Wondering if cross-checks of version compatibility will be pratical.</li>
<li>Interest in packaging it as a WildFly Swarm Fraction? Happy to help, would be nice to have it released together with any new client release.</il>
</ul>
	</section>
</section>

<section>
<h2>Digression: WildFly Swarm Fraction?</h2>
<p>Aka "JBoss Module" packaging
<ul>
<li>the project influenced Java 9's Jigsaw</li>
<li>Heavily used within WildFly, WildFly Swarm.</li>
<li>Very easy packaging: just explicitly list your dependencies in a file.</li>
<li>Does not affect compiletime (unlike Jigsaw).</li>
<li>We do re-package Apache Lucene & several others..</li>
</ul>
</section>

<!-- FIXME needs a recall of all concepts -->

<!-- Wrapping up -->

<section style="text-align: left;">
<h2>Thank you!</h2>
<p>Some references:</p>
<ul>
	<li>Hibernate team's blog <a href="http://in.relation.to/">in.relation.to</a></li>
	<li>Hibernate Search: <a href="http://hibernate.org/search/">hibernate.org/search</a></li>
	<li>WildFly: <a href="http://wildfly.org">wildfly.org</a></li>
	<li>Infinispan: <a href="http://infinispan.org/">infinispan.org</a>
	<li><a href="?print-pdf">Export these slides to PDF</a><small>(requires Chrome)</small></li>
</ul>
<p><a href="https://github.com/hibernate/hibernate-search">github.com/hibernate/hibernate-search</a></p>
<p>Our mailing list search, powered by Elasticsearch: <a href="http://search.jboss.org/#!q=&project=hibernate&sortBy=new">http://search.jboss.org/</a></p>
</section>

<!-- End -->

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>

